<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaire</title>
    <style>
        /* Add your redesigned CSS here */
    </style>
</head>
<body>

<div class="container">
    <div class="left-section">
        <div class="input-group">
            <label for="title">Tiêu đề:</label>
            <input type="text" id="title" >
        </div>
        <div class="input-group">
            <label for="time">Thời gian:</label>
            <input type="text" id="time" >
        </div>
        <div class="input-group">
            <label for="term">Kì thi:</label>
            <input type="text" id="term" >
        </div>
        <div class="input-group">
            <label for="subject">Môn học:</label>
            <input type="text" id="subject">
        </div>
        <div class="button-group">
            <button class="btn save">Lưu</button>
            <button class="btn cancel">Hủy</button>
        </div>
    </div>
    <div class="right-section">
        <div class="question-card" id="question-card-0">
            <div class="question-header">Sample Question Title</div>
            <div class="question-info">
                <p>Sample question content...</p>
                <div id="question-criteria-0" class="selected-criteria"></div>
                <ul class="criterias">
                    <li><a href="javascript:void(0)" class="cribtn">Criteria</a>
                        <ul class="criterias-content">
                            <li><a href="javascript:void(0)" class="criterias-element" id="question-criteria-0" data-criteria="Criteria 1">Criteria 1</a></li>
                            <li><a href="javascript:void(0)" class="criterias-element" id="question-criteria-0" data-criteria="Criteria 2">Criteria 2</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="question-actions">
                <button class="btn btn-up" id="btn-up-0">&#9650;</button>
                <button class="btn btn-down" id="btn-down-0">&#9660;</button>
                <button class="btn btn-delete" id="btn-delete-0">&#128465;</button>
            </div>
        </div>
        <button class="question-add">+</button>
    </div>
</div>

<!-- Modal Structure -->
<div id="questionModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="questionList"></div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const criteriaElements = document.querySelectorAll(".criterias-element");

    criteriaElements.forEach(element => {
        element.addEventListener("click", function() {
            const criteria = this.getAttribute("data-criteria");
            const questionId = this.getAttribute("id");
            addCriteria(criteria, questionId);
        });
    });

    function addCriteria(criteria, questionId) {
        const selectedCriteriaContainer = document.getElementById(questionId);
        selectedCriteriaContainer.innerHTML = "";

        const criteriaItem = document.createElement("span");
        criteriaItem.className = "selected-criteria-item";
        criteriaItem.textContent = criteria;
        criteriaItem.setAttribute("data-id", questionId);

        criteriaItem.addEventListener("click", function() {
            this.remove();
        });

        selectedCriteriaContainer.appendChild(criteriaItem);
    }

    const upButtons = document.querySelectorAll('.btn-up');
    const downButtons = document.querySelectorAll('.btn-down');
    const deleteButtons = document.querySelectorAll('.btn-delete');

    upButtons.forEach(button => {
        button.addEventListener('click', function() {
            const questionCard = this.closest('.question-card');
            const previousCard = questionCard.previousElementSibling;
            if (previousCard && previousCard.classList.contains('question-card')) {
                questionCard.parentNode.insertBefore(questionCard, previousCard);
            }
        });
    });

    downButtons.forEach(button => {
        button.addEventListener('click', function() {
            const questionCard = this.closest('.question-card');
            const nextCard = questionCard.nextElementSibling;
            if (nextCard && nextCard.classList.contains('question-card')) {
                questionCard.parentNode.insertBefore(nextCard, questionCard);
            }
        });
    });

    deleteButtons.forEach(button => {
        button.addEventListener('click', function() {
            const questionCard = this.closest('.question-card');
            questionCard.remove();
        });
    });

    const addButton = document.querySelector('.question-add');
    const modal = document.getElementById("questionModal");
    const closeModal = document.querySelector(".close");
    const questionList = document.getElementById("questionList");

    addButton.addEventListener('click', function() {
        fetch('/mnt/data/selectQues.hbs')  // Assuming your questions are in a file called selectQues.hbs
            .then(response => response.text())
            .then(data => {
                questionList.innerHTML = data;
                modal.style.display = "block";
                attachQuestionSelectionHandlers();
            });
    });

    closeModal.addEventListener('click', function() {
        modal.style.display = "none";
    });

    window.addEventListener('click', function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    });

    function attachQuestionSelectionHandlers() {
        const questionItems = document.querySelectorAll('.question-item');
        questionItems.forEach(item => {
            item.addEventListener('click', function() {
                const questionContent = this.innerHTML;
                addQuestion(questionContent);
                modal.style.display = "none";
            });
        });
    }

    function addQuestion(content) {
        const newQuestionCard = document.createElement('div');
        newQuestionCard.className = 'question-card';
        newQuestionCard.innerHTML = `
            <div class="question-header">${content}</div>
            <div class="question-info">
                <p>${content}</p>
                <div class="selected-criteria"></div>
                <ul class="criterias">
                    <li><a href="javascript:void(0)" class="cribtn">Criteria</a>
                        <ul class="criterias-content">
                            <li><a href="javascript:void(0)" class="criterias-element">Criteria 1</a></li>
                            <li><a href="javascript:void(0)" class="criterias-element">Criteria 2</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="question-actions">
                <button class="btn btn-up">&#9650;</button>
                <button class="btn btn-down">&#9660;</button>
                <button class="btn btn-delete">&#128465;</button>
            </div>
        `;
        document.querySelector('.right-section').insertBefore(newQuestionCard, addButton);
    }
});
</script>

</body>
</html>
